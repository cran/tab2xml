<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>tab2xml: XML Generation from Tables</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">tab2xml: XML Generation from Tables</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>XML files are commonly used to configure various tools and
applications. While there are dedicated tools for generating XML files
through structured input forms, in many cases, it is beneficial to
organize data in tables linked by primary and foreign keys, especially
when dealing with large datasets or multiple instances of the same
entity.</p>
<p>The <code>tab2xml</code> package provides a solution by enabling the
generation of XML files based on predefined <strong>templates</strong>
and structured tabular data stored in <strong>Excel (.xlsx) or
OpenDocument Spreadsheet (.ods) files</strong>. By leveraging relational
tables, users can efficiently handle and manage large-scale data entry,
ensuring consistency and ease of modification.</p>
<p>This approach simplifies XML creation, making it more accessible and
scalable when working with complex data structures.</p>
<div id="content" class="section level2">
<h2>Content</h2>
<p>In addition to this introduction, the document includes:</p>
<ul>
<li><p>An example based on the definition of an XML schema for
<em>Mondrian</em>, following the <a href="https://mondrian.pentaho.com/documentation/schema.php">Mondrian
Documentation</a>.</p></li>
<li><p>A breakdown of each schema element, detailing the corresponding
tables, their relationships, and the XML templates used for data
transformation.</p></li>
<li><p>The process of transforming elements to generate the
schema.</p></li>
</ul>
</div>
</div>
<div id="example-mondrian-schema" class="section level1">
<h1>Example: Mondrian Schema</h1>
<p>The starting point for this example is the Mondrian schema, based on
a schema example from the <a href="https://mondrian.pentaho.com/documentation/schema.php">Mondrian
Documentation</a>, shown below.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>&lt;<span class="kw">Schema</span>&gt;</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>    &lt;<span class="kw">Cube</span><span class="ot"> name=</span><span class="st">&quot;Sales&quot;</span>&gt;</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>        &lt;<span class="kw">Table</span><span class="ot"> name=</span><span class="st">&quot;sales_fact_1997&quot;</span> /&gt;</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>        &lt;<span class="kw">Dimension</span><span class="ot"> name=</span><span class="st">&quot;Gender&quot;</span><span class="ot"> foreignKey=</span><span class="st">&quot;customer_id&quot;</span>&gt;</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>            &lt;<span class="kw">Hierarchy</span><span class="ot"> name=</span><span class="st">&quot;Gender&quot;</span><span class="ot"> hasAll=</span><span class="st">&quot;true&quot;</span><span class="ot"> allMemberName=</span><span class="st">&quot;All Genders&quot;</span><span class="ot"> primaryKey=</span><span class="st">&quot;customer_id&quot;</span>&gt;</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>                &lt;<span class="kw">Table</span><span class="ot"> name=</span><span class="st">&quot;customer&quot;</span> /&gt;</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>                &lt;<span class="kw">Level</span><span class="ot"> name=</span><span class="st">&quot;Gender&quot;</span><span class="ot"> column=</span><span class="st">&quot;gender&quot;</span><span class="ot"> type=</span><span class="st">&quot;String&quot;</span><span class="ot"> uniqueMembers=</span><span class="st">&quot;true&quot;</span> /&gt;</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>            &lt;/<span class="kw">Hierarchy</span>&gt;</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>        &lt;/<span class="kw">Dimension</span>&gt;</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>        &lt;<span class="kw">Dimension</span><span class="ot"> name=</span><span class="st">&quot;Time&quot;</span><span class="ot"> foreignKey=</span><span class="st">&quot;time_id&quot;</span>&gt;</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>            &lt;<span class="kw">Hierarchy</span><span class="ot"> name=</span><span class="st">&quot;Time&quot;</span><span class="ot"> hasAll=</span><span class="st">&quot;false&quot;</span><span class="ot">  primaryKey=</span><span class="st">&quot;time_id&quot;</span>&gt;</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>                &lt;<span class="kw">Table</span><span class="ot"> name=</span><span class="st">&quot;time_by_day&quot;</span> /&gt;</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>                &lt;<span class="kw">Level</span><span class="ot"> name=</span><span class="st">&quot;Year&quot;</span><span class="ot"> column=</span><span class="st">&quot;the_year&quot;</span><span class="ot"> type=</span><span class="st">&quot;Numeric&quot;</span><span class="ot"> uniqueMembers=</span><span class="st">&quot;true&quot;</span> /&gt;</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>                &lt;<span class="kw">Level</span><span class="ot"> name=</span><span class="st">&quot;Quarter&quot;</span><span class="ot"> column=</span><span class="st">&quot;quarter&quot;</span><span class="ot"> type=</span><span class="st">&quot;Numeric&quot;</span><span class="ot"> uniqueMembers=</span><span class="st">&quot;false&quot;</span> /&gt;</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>                &lt;<span class="kw">Level</span><span class="ot"> name=</span><span class="st">&quot;Month&quot;</span><span class="ot"> column=</span><span class="st">&quot;month_of_year&quot;</span><span class="ot"> type=</span><span class="st">&quot;Numeric&quot;</span><span class="ot"> uniqueMembers=</span><span class="st">&quot;false&quot;</span> /&gt;</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>            &lt;/<span class="kw">Hierarchy</span>&gt;</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>        &lt;/<span class="kw">Dimension</span>&gt;</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>        &lt;<span class="kw">Measure</span><span class="ot"> name=</span><span class="st">&quot;Unit Sales&quot;</span><span class="ot"> column=</span><span class="st">&quot;unit_sales&quot;</span><span class="ot"> aggregator=</span><span class="st">&quot;sum&quot;</span><span class="ot"> formatString=</span><span class="st">&quot;#,###&quot;</span> /&gt;</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>        &lt;<span class="kw">Measure</span><span class="ot"> name=</span><span class="st">&quot;Store Sales&quot;</span><span class="ot"> column=</span><span class="st">&quot;store_sales&quot;</span><span class="ot"> aggregator=</span><span class="st">&quot;sum&quot;</span><span class="ot"> formatString=</span><span class="st">&quot;#,###.##&quot;</span> /&gt;</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>        &lt;<span class="kw">Measure</span><span class="ot"> name=</span><span class="st">&quot;Store Cost&quot;</span><span class="ot"> column=</span><span class="st">&quot;store_cost&quot;</span><span class="ot"> aggregator=</span><span class="st">&quot;sum&quot;</span><span class="ot"> formatString=</span><span class="st">&quot;#,###.00&quot;</span> /&gt;</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>        &lt;<span class="kw">CalculatedMember</span><span class="ot"> name=</span><span class="st">&quot;Profit&quot;</span><span class="ot"> dimension=</span><span class="st">&quot;Measures&quot;</span><span class="ot"> formula=</span><span class="st">&quot;[Measures].[Store Sales] - [Measures].[Store Cost]&quot;</span>&gt;</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>            &lt;<span class="kw">CalculatedMemberProperty</span><span class="ot"> name=</span><span class="st">&quot;FORMAT_STRING&quot;</span><span class="ot"> value=</span><span class="st">&quot;$#,##0.00&quot;</span> /&gt;</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>        &lt;/<span class="kw">CalculatedMember</span>&gt;</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>    &lt;/<span class="kw">Cube</span>&gt;</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>&lt;/<span class="kw">Schema</span>&gt;</span></code></pre></div>
<p>To define this schema, we can either edit the XML file directly or
use the <em>Pentaho Schema Workbench</em> tool. Another approach is to
break it down into tables and templates, work with the tables, and
generate the required versions directly, as shown below.</p>
</div>
<div id="scheme-decomposition" class="section level1">
<h1>Scheme decomposition</h1>
<p>Next, we will decompose the content of this schema into tables,
defined as sheets in the spreadsheets files (.xlsx or .ods) included in
the package, and templates.</p>
<div id="root-of-the-schema-template-schema_template.xml" class="section level2">
<h2>Root of the schema template: <code>schema_template.xml</code></h2>
<p>Below is the root of the schema template.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>&lt;<span class="kw">Schema</span>&gt;</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    {Cube}</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>&lt;/<span class="kw">Schema</span>&gt;</span></code></pre></div>
<p><strong>The root can contain only one token</strong> (in this case,
the <code>{Cube}</code> token). If multiple tokens or none are found, an
error is raised.</p>
<ul>
<li><p>Tokens are defined using a name enclosed in <code>{</code> and
<code>}</code>.</p></li>
<li><p>Token names are case-insensitive.</p></li>
<li><p><strong>Tokens reference either sheets in the spreadsheet or
columns in the sheet associated with each element</strong>.</p></li>
</ul>
<p>In the example, a schema consists of one or more cubes.</p>
<p>Starting from the root, each element must have an associated
<strong>sheet</strong> and a <strong>template</strong> file, where the
sheet’s columns or other components are included.</p>
</div>
<div id="cube" class="section level2">
<h2>Cube</h2>
<p>Only one cube is defined in the schema; therefore, the table contains
only one row.</p>
<ul>
<li><p>If we need to reference this element from another, we add a
<strong>primary key column</strong>. The name of this column
<strong>must consist of the sheet name followed by the <code>_pk</code>
suffix</strong>.</p></li>
<li><p>To reference elements from another table, we add a
<strong>foreign key column</strong>, named <strong>after the referenced
sheet with the <code>_fk</code> suffix</strong>.</p></li>
</ul>
<p>In this case, a cube has an associated table. However, since other
elements can also have associated tables, we add the foreign key to the
cube (as well as to each element with an associated table).</p>
<table>
<thead>
<tr class="header">
<th align="right">cube_pk</th>
<th align="left">name</th>
<th align="right">table_fk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Sales</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Regarding the template, we can include two types of tokens:</p>
<ul>
<li>Tokens referencing <strong>table columns</strong>: these will be
replaced with a value.<br />
</li>
<li>Tokens referencing <strong>other elements</strong> (referenced by
the sheet name): these will be replaced with another template.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>    &lt;<span class="kw">Cube</span><span class="ot"> name=</span><span class="st">&quot;{name}&quot;</span>&gt;</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>        {Table}</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>        {Dimension}</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>        {Measure}</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>        {CalculatedMember}</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    &lt;/<span class="kw">Cube</span>&gt;</span></code></pre></div>
<p><strong>When including tokens that reference other sheets, each token
must be placed on a separate line, as they will be replaced with
templates.</strong></p>
</div>
<div id="table" class="section level2">
<h2>Table</h2>
<p>Since the tables are referenced by other elements, we define a
primary key with values to allow referencing (as we did from the
cube).</p>
<table>
<thead>
<tr class="header">
<th align="right">table_pk</th>
<th align="left">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">sales_fact_1997</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">customer</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">time_by_day</td>
</tr>
</tbody>
</table>
<p>The template only needs to include the table name using the specified
syntax.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>                &lt;<span class="kw">Table</span><span class="ot"> name=</span><span class="st">&quot;{name}&quot;</span> /&gt;</span></code></pre></div>
</div>
<div id="dimension" class="section level2">
<h2>Dimension</h2>
<p>Each dimension is included in a cube and can also contain other
elements that reference it.</p>
<table>
<thead>
<tr class="header">
<th align="right">dimension_pk</th>
<th align="left">name</th>
<th align="left">foreignKey</th>
<th align="right">cube_fk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Gender</td>
<td align="left">customer_id</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Time</td>
<td align="left">time_id</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>In the template, the sheet’s columns and the containing element
(which includes one or more hierarchies) are referenced.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>        &lt;<span class="kw">Dimension</span><span class="ot"> name=</span><span class="st">&quot;{name}&quot;</span><span class="ot"> foreignKey=</span><span class="st">&quot;{foreignKey}&quot;</span>&gt;</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>            {Hierarchy}</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>        &lt;/<span class="kw">Dimension</span>&gt;</span></code></pre></div>
</div>
<div id="hierarchy" class="section level2">
<h2>Hierarchy</h2>
<p>Hierarchies reference both the dimensions that contain them and their
associated tables.</p>
<table>
<colgroup>
<col width="14%" />
<col width="7%" />
<col width="7%" />
<col width="31%" />
<col width="13%" />
<col width="14%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">hierarchy_pk</th>
<th align="left">name</th>
<th align="left">hasAll</th>
<th align="left">allMemberName</th>
<th align="left">primaryKey</th>
<th align="right">dimension_fk</th>
<th align="right">table_fk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Gender</td>
<td align="left">true</td>
<td align="left">allMemberName=“All Genders”</td>
<td align="left">customer_id</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Time</td>
<td align="left">false</td>
<td align="left">NA</td>
<td align="left">time_id</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<p>In the template, we can see that it includes the table and the levels
that make up the hierarchy.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>            &lt;<span class="kw">Hierarchy</span><span class="ot"> name=</span><span class="st">&quot;{name}&quot;</span><span class="ot"> hasAll=</span><span class="st">&quot;{hasAll}&quot;</span> <span class="er">{</span><span class="ot">allMemberName</span><span class="er">}</span> <span class="er">primaryKey</span><span class="ot">=</span><span class="st">&quot;{primaryKey}&quot;</span>&gt;</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>                {Table}</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                {Level}</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>            &lt;/<span class="kw">Hierarchy</span>&gt;</span></code></pre></div>
</div>
<div id="level" class="section level2">
<h2>Level</h2>
<p>Levels do not need to be referenced, so they do not include a primary
key. Instead, they reference the hierarchies they belong to.</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">column</th>
<th align="left">type</th>
<th align="left">uniqueMembers</th>
<th align="right">hierarchy_fk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Gender</td>
<td align="left">gender</td>
<td align="left">String</td>
<td align="left">true</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Year</td>
<td align="left">the_year</td>
<td align="left">Numeric</td>
<td align="left">true</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Quarter</td>
<td align="left">quarter</td>
<td align="left">Numeric</td>
<td align="left">false</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Month</td>
<td align="left">month_of_year</td>
<td align="left">Numeric</td>
<td align="left">false</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>The template references the columns of the associated sheet.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>                &lt;<span class="kw">Level</span><span class="ot"> name=</span><span class="st">&quot;{name}&quot;</span><span class="ot"> column=</span><span class="st">&quot;{column}&quot;</span><span class="ot"> type=</span><span class="st">&quot;{type}&quot;</span><span class="ot"> uniqueMembers=</span><span class="st">&quot;{uniqueMembers}&quot;</span> /&gt;</span></code></pre></div>
</div>
<div id="measure" class="section level2">
<h2>Measure</h2>
<p>Measures are included in cubes and must reference them. Since they do
not need to be referenced, they do not require a primary key.</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">column</th>
<th align="left">aggregator</th>
<th align="left">formatString</th>
<th align="right">cube_fk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Unit Sales</td>
<td align="left">unit_sales</td>
<td align="left">sum</td>
<td align="left">#,###</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Store Sales</td>
<td align="left">store_sales</td>
<td align="left">sum</td>
<td align="left">#,###.##</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Store Cost</td>
<td align="left">store_cost</td>
<td align="left">sum</td>
<td align="left">#,###.00</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The template includes the columns from the sheet.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>        &lt;<span class="kw">Measure</span><span class="ot"> name=</span><span class="st">&quot;{name}&quot;</span><span class="ot"> column=</span><span class="st">&quot;{column}&quot;</span><span class="ot"> aggregator=</span><span class="st">&quot;{aggregator}&quot;</span><span class="ot"> formatString=</span><span class="st">&quot;{formatString}&quot;</span> /&gt;</span></code></pre></div>
</div>
<div id="calculatedmember" class="section level2">
<h2>CalculatedMember</h2>
<p>Calculated members may have components that must be referenceable
(they have a primary key) and are included in cubes.</p>
<table>
<colgroup>
<col width="20%" />
<col width="7%" />
<col width="10%" />
<col width="53%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">calculatedmember_pk</th>
<th align="left">name</th>
<th align="left">dimension</th>
<th align="left">formula</th>
<th align="right">cube_fk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Profit</td>
<td align="left">Measures</td>
<td align="left">[Measures].[Store Sales] - [Measures].[Store Cost]</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The template shows the elements they contain.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>        &lt;<span class="kw">CalculatedMember</span><span class="ot"> name=</span><span class="st">&quot;{name}&quot;</span><span class="ot"> dimension=</span><span class="st">&quot;{dimension}&quot;</span><span class="ot"> formula=</span><span class="st">&quot;{formula}&quot;</span>&gt;</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>            {CalculatedMemberProperty}</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>        &lt;/<span class="kw">CalculatedMember</span>&gt;</span></code></pre></div>
</div>
<div id="calculatedmemberproperty" class="section level2">
<h2>CalculatedMemberProperty</h2>
<p>Finally, we have the properties of the calculated members they
reference.</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">value</th>
<th align="right">calculatedmember_fk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">FORMAT_STRING</td>
<td align="left">$#,##0.00</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The template uses the columns from the corresponding sheet.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>            &lt;<span class="kw">CalculatedMemberProperty</span><span class="ot"> name=</span><span class="st">&quot;{name}&quot;</span><span class="ot"> value=</span><span class="st">&quot;{value}&quot;</span> /&gt;</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>            </span></code></pre></div>
</div>
</div>
<div id="generate-the-schema" class="section level1">
<h1>Generate the Schema</h1>
<p>To generate the schema, tokens in each template are replaced with
corresponding values from a data source.</p>
<p>It handles both direct replacements from the associated sheet and
foreign key relationships.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">library</span>(tab2xml)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co"># Define file paths</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>source_xml <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;schema_template.xml&quot;</span>, <span class="at">package =</span> <span class="st">&quot;tab2xml&quot;</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>source_xlsx <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;schema.xlsx&quot;</span>, <span class="at">package =</span> <span class="st">&quot;tab2xml&quot;</span>)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>temp_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.xml&quot;</span>)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co"># Convert spreadsheet to XML</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">sheet2xml</span>(source_xlsx, source_xml, temp_file)</span></code></pre></div>
<p>As shown in the example, we only need to specify:</p>
<ul>
<li><p>The <strong>spreadsheet file</strong>.</p></li>
<li><p>The <strong>root template</strong>. The rest of the templates
must be located in the same folder as the root template and are
determined from the content of the templates being processed.</p></li>
<li><p>The name of the <strong>output XML file</strong> (if none is
specified, a file with the same name as the spreadsheet is created in
the same location).</p></li>
</ul>
<p>The resulting output is shown below.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>xml_content <span class="ot">&lt;-</span> <span class="fu">readLines</span>(file, <span class="at">warn =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;```xml</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="fu">paste</span>(xml_content, <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">```&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>&lt;<span class="kw">Schema</span>&gt;</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>    &lt;<span class="kw">Cube</span><span class="ot"> name=</span><span class="st">&quot;Sales&quot;</span>&gt;</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>                &lt;<span class="kw">Table</span><span class="ot"> name=</span><span class="st">&quot;sales_fact_1997&quot;</span> /&gt;</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>        &lt;<span class="kw">Dimension</span><span class="ot"> name=</span><span class="st">&quot;Gender&quot;</span><span class="ot"> foreignKey=</span><span class="st">&quot;customer_id&quot;</span>&gt;</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>            &lt;<span class="kw">Hierarchy</span><span class="ot"> name=</span><span class="st">&quot;Gender&quot;</span><span class="ot"> hasAll=</span><span class="st">&quot;true&quot;</span><span class="ot"> allMemberName=</span><span class="st">&quot;All Genders&quot;</span><span class="ot"> primaryKey=</span><span class="st">&quot;customer_id&quot;</span>&gt;</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>                &lt;<span class="kw">Table</span><span class="ot"> name=</span><span class="st">&quot;customer&quot;</span> /&gt;</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>                &lt;<span class="kw">Level</span><span class="ot"> name=</span><span class="st">&quot;Gender&quot;</span><span class="ot"> column=</span><span class="st">&quot;gender&quot;</span><span class="ot"> type=</span><span class="st">&quot;String&quot;</span><span class="ot"> uniqueMembers=</span><span class="st">&quot;true&quot;</span> /&gt;</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>            &lt;/<span class="kw">Hierarchy</span>&gt;</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>        &lt;/<span class="kw">Dimension</span>&gt;</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>        &lt;<span class="kw">Dimension</span><span class="ot"> name=</span><span class="st">&quot;Time&quot;</span><span class="ot"> foreignKey=</span><span class="st">&quot;time_id&quot;</span>&gt;</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>            &lt;<span class="kw">Hierarchy</span><span class="ot"> name=</span><span class="st">&quot;Time&quot;</span><span class="ot"> hasAll=</span><span class="st">&quot;false&quot;</span><span class="ot">  primaryKey=</span><span class="st">&quot;time_id&quot;</span>&gt;</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>                &lt;<span class="kw">Table</span><span class="ot"> name=</span><span class="st">&quot;time_by_day&quot;</span> /&gt;</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>                &lt;<span class="kw">Level</span><span class="ot"> name=</span><span class="st">&quot;Year&quot;</span><span class="ot"> column=</span><span class="st">&quot;the_year&quot;</span><span class="ot"> type=</span><span class="st">&quot;Numeric&quot;</span><span class="ot"> uniqueMembers=</span><span class="st">&quot;true&quot;</span> /&gt;</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>                &lt;<span class="kw">Level</span><span class="ot"> name=</span><span class="st">&quot;Quarter&quot;</span><span class="ot"> column=</span><span class="st">&quot;quarter&quot;</span><span class="ot"> type=</span><span class="st">&quot;Numeric&quot;</span><span class="ot"> uniqueMembers=</span><span class="st">&quot;false&quot;</span> /&gt;</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>                &lt;<span class="kw">Level</span><span class="ot"> name=</span><span class="st">&quot;Month&quot;</span><span class="ot"> column=</span><span class="st">&quot;month_of_year&quot;</span><span class="ot"> type=</span><span class="st">&quot;Numeric&quot;</span><span class="ot"> uniqueMembers=</span><span class="st">&quot;false&quot;</span> /&gt;</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>            &lt;/<span class="kw">Hierarchy</span>&gt;</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>        &lt;/<span class="kw">Dimension</span>&gt;</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>        &lt;<span class="kw">Measure</span><span class="ot"> name=</span><span class="st">&quot;Unit Sales&quot;</span><span class="ot"> column=</span><span class="st">&quot;unit_sales&quot;</span><span class="ot"> aggregator=</span><span class="st">&quot;sum&quot;</span><span class="ot"> formatString=</span><span class="st">&quot;#,###&quot;</span> /&gt;</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>        &lt;<span class="kw">Measure</span><span class="ot"> name=</span><span class="st">&quot;Store Sales&quot;</span><span class="ot"> column=</span><span class="st">&quot;store_sales&quot;</span><span class="ot"> aggregator=</span><span class="st">&quot;sum&quot;</span><span class="ot"> formatString=</span><span class="st">&quot;#,###.##&quot;</span> /&gt;</span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>        &lt;<span class="kw">Measure</span><span class="ot"> name=</span><span class="st">&quot;Store Cost&quot;</span><span class="ot"> column=</span><span class="st">&quot;store_cost&quot;</span><span class="ot"> aggregator=</span><span class="st">&quot;sum&quot;</span><span class="ot"> formatString=</span><span class="st">&quot;#,###.00&quot;</span> /&gt;</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>        &lt;<span class="kw">CalculatedMember</span><span class="ot"> name=</span><span class="st">&quot;Profit&quot;</span><span class="ot"> dimension=</span><span class="st">&quot;Measures&quot;</span><span class="ot"> formula=</span><span class="st">&quot;[Measures].[Store Sales] - [Measures].[Store Cost]&quot;</span>&gt;</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>            &lt;<span class="kw">CalculatedMemberProperty</span><span class="ot"> name=</span><span class="st">&quot;FORMAT_STRING&quot;</span><span class="ot"> value=</span><span class="st">&quot;$#,##0.00&quot;</span> /&gt;</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>            </span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>        &lt;/<span class="kw">CalculatedMember</span>&gt;</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>    &lt;/<span class="kw">Cube</span>&gt;</span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>&lt;/<span class="kw">Schema</span>&gt;</span></code></pre></div>
<div id="conclusions" class="section level2">
<h2>Conclusions</h2>
<p>The <code>tab2xml</code> package offers an efficient and scalable
method for generating XML files from tabular data. By using structured
templates and relational tables, the package facilitates the management
of complex datasets while maintaining consistency and accuracy.</p>
<p>This approach is particularly advantageous for scenarios requiring
the generation of large XML files or handling multiple entities with
defined relationships. It streamlines the transformation process,
reduces manual errors, and enhances maintainability by allowing users to
modify the underlying data without altering the XML structure.</p>
<p>The provided example, based on the <em>Mondrian</em> schema,
demonstrates how to apply this methodology to real-world use cases. This
framework can be extended to other domains requiring XML generation from
relational data, offering a flexible and robust solution for data-driven
XML creation.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
